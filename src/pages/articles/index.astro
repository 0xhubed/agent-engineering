---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const allArticles = await getCollection('articles');
const articles = allArticles.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

// Group by category â€” sorted alphabetically for stable display order
const categories = [...new Set(articles.map(a => a.data.category))].sort();

function fmtDate(d: string) {
  const dt = new Date(d + 'T12:00:00');
  if (isNaN(dt.getTime())) return d;
  return dt.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
}
---

<BaseLayout title="Articles" description="Browse all articles on AI agent architecture, engineering patterns, and emerging protocols.">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">

    <!-- Masthead -->
    <div class="text-center mb-8">
      <h1 class="font-display font-bold text-ink" style="font-size: clamp(2rem, 5vw, 3.5rem);">
        Articles
      </h1>
      <p class="font-serif italic text-ink-muted mt-2">
        A practitioner's reference for AI agent architecture and engineering patterns.
      </p>
      <hr class="rule-double mt-6" />
    </div>

    <!-- Articles by category -->
    {categories.map((category) => (
      <section class="mb-12">
        <h2 class="section-label mb-4">{category}</h2>
        <div class="space-y-0 divide-y divide-newsprint-200">
          {articles
            .filter(a => a.data.category === category)
            .map((article) => (
              <div class="py-4">
                <a href={`/articles/${article.slug}/`} class="no-underline group flex items-start justify-between gap-4">
                  <div class="flex-1">
                    <h3 class="font-display font-semibold text-ink text-lg leading-tight group-hover:underline">
                      {article.data.title}
                    </h3>
                    <p class="font-serif text-sm text-ink-muted mt-1 leading-snug">
                      {article.data.description}
                    </p>
                    <div class="flex flex-wrap gap-1 mt-2">
                      {article.data.tags.slice(0, 3).map((tag: string) => (
                        <span class="tag-chip">{tag}</span>
                      ))}
                    </div>
                  </div>
                  <span class="font-serif text-xs text-ink-faint whitespace-nowrap mt-1">
                    {fmtDate(article.data.date)}
                  </span>
                </a>
              </div>
            ))
          }
        </div>
      </section>
    ))}

  </div>
</BaseLayout>
