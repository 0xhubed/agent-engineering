---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const allArticles = await getCollection('articles');
const topics = allArticles
  .filter(a => a.data.type === 'topic')
  .sort((a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime());

const categories = [...new Set(topics.map(t => t.data.category))].sort();

function fmtDate(d: string) {
  const dt = new Date(d + 'T12:00:00');
  if (isNaN(dt.getTime())) return d;
  return dt.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
}
---

<BaseLayout title="Topics" description="Core concepts and patterns for building AI agents — with prose explanations and code examples.">
  <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12">

    <div class="text-center mb-8">
      <h1 class="font-display font-bold text-ink" style="font-size: clamp(1.75rem, 4vw, 3rem);">
        Topics
      </h1>
      <p class="font-serif italic text-ink-muted mt-2 max-w-xl mx-auto">
        Core concepts and patterns for building AI agents — with prose explanations and code examples.
      </p>
      <hr class="rule-double mt-6" />
    </div>

    {categories.map((category) => (
      <section class="mb-10">
        <h2 class="section-label mb-4">{category}</h2>
        <div class="space-y-0 divide-y divide-newsprint-200">
          {topics.filter(t => t.data.category === category).map((topic) => (
            <div class="py-4">
              <a href={`/articles/${topic.slug}/`} class="no-underline group flex items-start justify-between gap-4">
                <div class="flex-1">
                  <h3 class="font-display font-semibold text-ink text-lg leading-tight group-hover:underline">
                    {topic.data.title}
                  </h3>
                  <p class="font-serif text-sm text-ink-muted mt-1 leading-snug">
                    {topic.data.description}
                  </p>
                  <div class="flex flex-wrap gap-1 mt-2">
                    {topic.data.tags.slice(0, 3).map((tag: string) => (
                      <span class="tag-chip">{tag}</span>
                    ))}
                  </div>
                </div>
                <span class="font-serif text-xs text-ink-faint whitespace-nowrap mt-1">
                  {fmtDate(topic.data.date)}
                </span>
              </a>
            </div>
          ))}
        </div>
      </section>
    ))}

  </div>
</BaseLayout>
