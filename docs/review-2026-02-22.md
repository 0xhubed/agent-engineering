# Code Review — Attribution Fix
**Date:** 2026-02-22
**Scope:** Five files changed to fix incorrect article attribution
**Reviewer:** Claude Code

---

## Summary

The change correctly removes the misleading "credit to original authors" attribution that pointed to a Twitter sharer rather than the actual article authors. The core intent is sound and the implementation mostly works. There are no critical bugs, but several medium and low severity issues are worth addressing before the next automated article run.

---

## Findings

### Architecture

**1. Medium — `scripts/generate-articles.py` line 218-223 — `assemble_mdx` writes an empty `authors` field when Claude returns `""`**

When Claude finds no authors in the source article it is instructed to return `"authors": ""`. `assemble_mdx` checks `if authors else ""` which correctly suppresses the line for a genuinely empty string. However, the schema field `authors` is `z.string().optional()`. An empty string `""` passes `z.string()` validation but is semantically equivalent to absent. If Claude returns an empty string, `authors_line` will be `""` (no line emitted), which is correct — but if it returns a single space or any whitespace, the line _will_ be written with `authors: " "`, which would then pass schema validation and be displayed in the layout as `" by  "`.

**Suggested fix:** Strip the value before the truthiness check:
```python
source_title = result.get("source_title", "").strip().replace('"', '\\"')
authors = result.get("authors", "").strip().replace('"', '\\"')
```

---

**2. Medium — `scripts/generate-articles.py` line 218 — `source_title` escaping is incomplete**

`source_title.replace('"', '\\"')` only escapes double quotes. YAML frontmatter inside a double-quoted scalar also needs backslash-escaping of backslashes themselves (a literal `\` in a title would produce `\"` which YAML reads as an escaped quote, corrupting the value). Additionally, a newline character in a scraped title (unlikely but possible from malformed HTML) would break the frontmatter entirely.

**Suggested fix:** Sanitise both fields more aggressively before writing to frontmatter:
```python
def _yaml_escape(s: str) -> str:
    return s.replace("\\", "\\\\").replace('"', '\\"').replace("\n", " ").replace("\r", "")
```

---

**3. Low — `scripts/generate-articles.py` line 225-236 — frontmatter field ordering is inconsistent with older articles**

Existing articles written before this change place `type` immediately after `date`. New articles now place `source_title` and `authors` between `source_url` and `tags`. This is functionally irrelevant (YAML is order-independent and Astro doesn't care) but makes diffs and manual review noisier. Consider a consistent ordering: `title → description → category → date → type → source_url → source_title → authors → shared_by → tags → featured`.

---

### Security

**4. Low — `scripts/generate-articles.py` lines 218-223 — no length limit on `source_title` or `authors` before writing to disk**

Claude is asked to extract these values from fetched article text. A malformed source page or a prompt-injection attempt in the source article could cause Claude to return an unexpectedly long string. There is no truncation before writing to the MDX file. While not directly exploitable (the output is a static MDX file committed to git and reviewed in a PR), it could produce a bloated file or exceed git diff readability. A `[:200]` guard on each field is sufficient.

---

### Bugs

**5. Medium — `src/layouts/ArticleLayout.astro` lines 89-98 — sentence construction is grammatically broken when `source_title` is absent but `authors` is present**

When `source_title` is falsy and `authors` is truthy, the rendered text becomes:

> This article is original educational content written by AI. Topic inspired by research published at https://...

The `authors` value is silently dropped because it is only rendered inside the `source_title` branch (line 93). This is the correct behaviour for the _intended_ data model (authors without a title is degenerate), but it is not obviously intentional and could surprise a future maintainer. If it is intentional, a comment would help. If it is not, the `authors` branch should be hoisted outside the `source_title` conditional.

The current logic produces valid output for the three real cases: (title + authors), (title only), and (no title, no authors). The edge case of (no title, but authors present) is suppressed silently, which is acceptable given that `assemble_mdx` only writes `authors` when it has a non-empty value and `source_title` comes from the same Claude response.

---

**6. Low — `src/layouts/ArticleLayout.astro` line 98 — trailing `{'.'}` is JSX-idiomatic but unnecessary**

The closing period is written as `{'.'}` rather than as a literal `.`. This works but the JSX expression is only needed here because the period would otherwise be outside the `<span>` whitespace normalisation. The layout comment above the attribution block (`<!-- Double rule -->`, etc.) style would benefit from a brief explanatory note that the period is intentionally outside the italic span.

No functional bug; purely a readability note.

---

**7. Low — `src/layouts/ArticleLayout.astro` line 97 — `{source_url}` is used as both link text and href**

The raw URL is displayed as link text (e.g., `https://red.anthropic.com/2026/zero-days/`). For long URLs this can overflow on narrow viewports. The existing `prose-a` styles do not include `break-all` or `word-break`. Consider using `source_title` as the link text when it is available:

```astro
<a href={source_url} ...>
  {source_title ?? source_url}
</a>
```

This is a UX issue, not a correctness issue, but it is the natural next step given that `source_title` is now available in scope.

---

### Code Quality

**8. Low — `src/content/config.ts` line 10 — `type` enum uses `'topic'` for AI-generated articles but `llm-vulnerability-discovery.mdx` is `type: "topic"` while `the-harness-is-the-product*.mdx` is `type: "article"`**

The `type` enum (`'topic' | 'article'`) does not match the `assemble_mdx` function, which hard-codes `type: "topic"` for all generated articles (line 231). The intent seems to be that hand-curated articles sourced from real posts are `"article"` and AI-generated educational pages are `"topic"`. This is a naming confusion risk: `llm-vulnerability-discovery.mdx` is AI-generated but has `type: "topic"`, consistent with what `assemble_mdx` writes. This is correct by convention but the convention is not documented. The prompt and the `assemble_mdx` function should agree, and they do — but a comment in `assemble_mdx` stating why `"topic"` is used for all generated articles would prevent a future maintainer from "fixing" it to `"article"`.

---

**9. Low — `src/content/articles/llm-vulnerability-discovery.mdx` line 8 — `source_url` domain is fictional**

The URL `https://red.anthropic.com/2026/zero-days/` does not appear to be a real Anthropic URL (Anthropic's research blog is at `anthropic.com/research` and `red.anthropic.com` is not a known subdomain). This is likely the URL that was in `news.json` at generation time and may have been a misquoted or hallucinated link. Since the attribution block displays this URL directly as a hyperlink on the live site, a dead or fictitious URL is worse than no URL. Verify the real source URL before this article is published; if no verifiable source can be found, remove `source_url` from the frontmatter so the attribution block is suppressed entirely.

---

**10. Low — `scripts/generate-articles.py` prompt line 84-85 — the `authors` instruction does not specify format for multi-author lists**

The prompt says `"Author names from the source article, comma-separated, or empty string if not found"`. The layout renders this as a bare string with ` by ` prepended. For long author lists (the `llm-vulnerability-discovery.mdx` article has 7 authors) this renders as:

> by Nicholas Carlini, Keane Lucas, Evyatar Ben Asher, Newton Cheng, Hasnain Lakhani, David Forsythe, Kyla Guru

This is functionally correct but can be long. It is a UX concern rather than a bug — the layout has no truncation logic. If brevity is desired, the prompt could instruct Claude to use "et al." for lists longer than 3 names, or the layout could truncate. No action required unless readability becomes a concern.

---

## Regression Analysis

Existing articles that have **no** `source_url` field (e.g., `a2a.mdx`, `tool-use.mdx`) are unaffected: the attribution `<div>` at lines 85–106 of `ArticleLayout.astro` is wrapped in `{source_url && (...)}` and is entirely suppressed when `source_url` is absent.

Existing articles that have `source_url` but **no** `source_title` or `authors` (e.g., `dynamic-filtering-web-search.mdx`, `context-bench.mdx`, `programmatic-tool-calling.mdx`) render the fallback branch:

> This article is original educational content written by AI. Topic inspired by research published at https://...

This is grammatically acceptable and a clear improvement over the old "credit to original authors" copy.

The `[slug].astro` page passes `source_title={entry.data.source_title}` and `authors={entry.data.authors}` directly from frontmatter. Because both schema fields are `optional()`, they will be `undefined` for older articles with no such keys — and the `ArticleLayout` interface types them as `string | undefined`. Astro's JSX handles `undefined` as falsy in conditionals, so no runtime error occurs.

---

## Priority Order

| # | Severity | Action |
|---|----------|--------|
| 2 | Medium | Fix incomplete YAML escaping in `assemble_mdx` (`\` and newline) |
| 1 | Medium | Strip whitespace before truthiness check for `authors`/`source_title` |
| 5 | Medium | Add comment clarifying `authors`-without-title suppression in layout |
| 9 | Low | Verify or remove the `source_url` in `llm-vulnerability-discovery.mdx` |
| 7 | Low | Use `source_title` as link text when available (UX improvement) |
| 4 | Low | Add length guards on `source_title`/`authors` before writing to disk |
| 8 | Low | Add comment in `assemble_mdx` explaining why `type: "topic"` is hard-coded |
| 3 | Low | Standardise frontmatter field ordering |
| 6 | Low | Add inline comment for `{'.'}` in layout |
| 10 | Low | Decide truncation strategy for long author lists |
